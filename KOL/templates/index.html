<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOLective â€“ AI-Powered KOL Matcher</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Choices.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f9f9f9;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .kol-card {
            position: relative;
            color: white;
            background-size: cover;
            background-position: center;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.10);
            min-height: 340px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            overflow: hidden;
            margin-bottom: 2rem;
            padding: 0;
            transition: box-shadow 0.2s, transform 0.2s;
        }
        .kol-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.35);
            z-index: 1;
        }
        .kol-card-overlay {
            position: absolute;
            inset: 0;
            background: rgba(30,30,40,0.92);
            color: #fff;
            opacity: 0;
            pointer-events: none;
            z-index: 3;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem 2rem 1.5rem 2rem;
            transition: opacity 0.3s;
        }
        .kol-card:hover .kol-card-overlay {
            opacity: 1;
            pointer-events: auto;
        }
        .kol-bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 1.1rem;
            width: 100%;
        }
        .kol-bar-label {
            font-weight: 600;
            min-width: 100px;
            margin-right: 0.7rem;
        }
        .kol-bar-bg {
            flex: 1;
            height: 18px;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            margin-left: 0.5rem;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }
        .kol-bar-fill {
            height: 100%;
            border-radius: 10px;
            width: 0%;
            transition: width 0.7s cubic-bezier(.4,2,.6,1);
        }
        .kol-appointment-btn {
            margin-top: 1.5rem;
            background: #e74c3c;
            color: #fff;
            border: none;
            border-radius: 999px;
            font-size: 1.1rem;
            font-weight: 600;
            padding: 0.7rem 2.2rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        .kol-appointment-btn:hover {
            background: #c0392b;
        }
        .kol-info {
            position: relative;
            z-index: 2;
            width: 100%;
            padding: 2rem 1rem 1.5rem 1rem;
            text-align: center;
        }
        .kol-info h2 {
            margin: 0 0 0.5rem;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .kol-info p.location {
            margin: 0 0 0.5rem;
            font-size: 1.1rem;
            font-weight: 500;
            color: #e0e0e0;
        }
        .kol-info p.bio {
            margin: 0;
            font-size: 1rem;
            font-weight: 400;
            color: #f5f5f5;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        @media (max-width: 600px) {
            .kol-card {
                min-height: 220px;
            }
            .kol-info h2 {
                font-size: 1.3rem;
            }
        }
        .testimonial-slider {
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
            min-height: 120px;
            transition: opacity 0.5s;
        }
        .testimonial-slider blockquote {
            font-style: italic;
            font-size: 1.2rem;
            margin: 1rem auto 0.5rem auto;
            max-width: 600px;
            min-height: 48px;
            transition: opacity 0.5s;
        }
        .testimonial-slider cite {
            display: block;
            font-size: 0.9rem;
            margin-top: 1rem;
            color: #666;
            min-height: 24px;
            transition: opacity 0.5s;
        }
        .testimonial-slider-multi {
            display: flex;
            gap: 2rem;
            justify-content: center;
            align-items: stretch;
            margin: 2rem 0 0 0;
            min-height: 220px;
            transition: opacity 0.5s;
        }
        .testimonial-card {
            background: #fff url('/static/testimonialbg.jpg') center/cover no-repeat;
            border-radius: 18px;
            box-shadow: 0 8px 24px rgba(60,60,60,0.13), 0 2px 8px rgba(0,0,0,0.10);
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            min-width: 260px;
            max-width: 350px;
            flex: 1 1 0;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            text-align: left;
            position: relative;
            transition: box-shadow 0.2s, transform 0.2s;
        }
        .testimonial-card blockquote {
            font-style: italic;
            font-size: 1.08rem;
            margin: 0 0 1.2rem 0;
            color: #222;
            line-height: 1.5;
        }
        .testimonial-card cite {
            font-size: 0.98rem;
            color: #3a3a3a;
            font-weight: 600;
            margin-top: auto;
            display: block;
            opacity: 0.85;
        }
        @media (max-width: 900px) {
            .testimonial-slider-multi {
                flex-direction: column;
                gap: 1.5rem;
                align-items: center;
            }
            .testimonial-card {
                max-width: 95vw;
                min-width: 0;
            }
        }
        .how-it-works h2,
        .testimonials h2 {
            font-family: 'Poppins', 'Inter', Arial, sans-serif;
            font-size: 3rem;
            font-weight: 900;
            letter-spacing: 0.5px;
            margin-bottom: 2.5rem;
            text-align: center;
        }
        .how-it-works h2 {
            color: #fff;
            -webkit-text-stroke: 2px #000;
            -webkit-text-stroke: 2px #000;
            text-shadow:
                0 2px 8px rgba(0,0,0,0.25),
                0 1px 0 #000,
                0 -1px 0 #000,
                1px 0 0 #000,
                -1px 0 0 #000;
            display: inline-block;
            transform: perspective(400px) rotateX(12deg);
            border-radius: 40px 40px 80px 80px/60px 60px 120px 120px;
            padding: 0.5em 1.5em;
            background: rgba(0,0,0,0.15);
        }
        .testimonials h2 {
            font-family: 'Poppins', 'Montserrat', 'Inter', Arial, sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: 1px;
            line-height: 1.1;
            color: #222;
            text-align: center;
            margin-bottom: 2.5rem;
            text-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        footer {
            background-color: #000;
            color: #fff;
            padding: 1rem 2rem;
            font-size: 0.9rem;
            text-align: center;
            border-top: 1px solid #222;
        }
        .appointment-button, .kol-appointment-btn {
            background-color: #e74c3c;
            color: #fff;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            padding: 12px 30px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        .appointment-button:hover, .kol-appointment-btn:hover {
            background-color: #c0392b;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
            transition: opacity 0.3s ease;
            opacity: 0;
        }
        .modal.show {
            display: block;
            opacity: 1;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background-color: #ffffff;
            margin: 3% auto;
            padding: 30px;
            border: none;
            width: 90%;
            max-width: 800px;
            border-radius: 16px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .form-container {
            margin-top: 25px;
            width: 100%;
            overflow: hidden;
            border-radius: 12px;
            background: #f8f9fa;
            padding: 20px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        .close {
            position: absolute;
            right: 25px;
            top: 20px;
            color: #666;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .close:hover {
            color: #e74c3c;
            background: rgba(231,76,60,0.1);
            transform: rotate(90deg);
        }
        .modal-content h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: #222;
            margin: 0 0 10px 0;
            text-align: center;
        }
        .modal-content iframe {
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .step {
            flex: 1;
            min-width: 250px;
            background: #fff url('/static/HIW.jpg') center/cover no-repeat;
            padding: 2rem 1.5rem;
            border-radius: 18px;
            box-shadow: 0 8px 24px rgba(60,60,60,0.18), 0 2px 8px rgba(0,0,0,0.10);
            margin: 1.5rem 0;
            font-size: 1.13rem;
            font-weight: 500;
            transition: transform 0.18s, box-shadow 0.18s;
            text-align: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(12px);
            background: rgba(255,255,255,0.6) url('/static/HIW.jpg') center/cover no-repeat;
        }
        .step::before {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.82);
            z-index: 1;
            border-radius: 18px;
        }
        .step h3, .step p {
            position: relative;
            z-index: 2;
        }
        .step h3 {
            font-family: 'Poppins', 'Inter', Arial, sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: #111;
            text-shadow: 0 2px 8px rgba(255,255,255,0.18), 0 1px 0 #fff;
        }
        .step p {
            font-family: 'Inter', Arial, sans-serif;
            font-size: 1.13rem;
            font-weight: 500;
            color: #222;
            text-shadow: 0 2px 8px rgba(255,255,255,0.12);
        }
        #backToTopBtn {
            display: none;
            position: fixed;
            bottom: 32px;
            right: 32px;
            z-index: 1000;
            background: #222 !important;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0,0,0,0.18);
            transition: background 0.2s, opacity 0.2s;
            opacity: 0.85;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        #backToTopBtn:hover {
            background: #e74c3c !important;
            opacity: 1;
        }
        #backToTopBtn svg {
            width: 32px;
            height: 32px;
            display: block;
        }
        .cta-button {
            display: inline-block;
            background: linear-gradient(90deg, #18c0ff 0%, #a259ff 100%);
            color: #fff;
            padding: 1.1rem 2.8rem;
            border-radius: 16px;
            text-decoration: none;
            font-weight: 700;
            font-size: 2rem;
            border: none;
            box-shadow: 0 4px 16px rgba(0,0,0,0.18);
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            letter-spacing: 0.5px;
        }
        .cta-button:hover {
            background: linear-gradient(90deg, #a259ff 0%, #18c0ff 100%);
            color: #fff;
            box-shadow: 0 6px 24px rgba(162,89,255,0.18);
        }
        .kol-star-icon {
            position: absolute;
            top: 14px;
            left: 14px;
            width: 40px;
            height: 40px;
            z-index: 5;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.18));
            pointer-events: none;
        }
        .kole-logo {
            position: absolute;
            top: 24px;
            left: 32px;
            width: 70px;
            height: auto;
            z-index: 10;
            border-radius: 12px;
        }
        .kole-hero-img {
            display: block;
            margin: 0 auto 0.1rem auto;
            max-width: 420px;
            width: 80vw;
            height: auto;
            filter: drop-shadow(0 4px 24px rgba(0,0,0,0.18));
        }
        .hero {
            position: relative;
            padding-top: 32px;
        }
        .hero-content {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            margin-top: 0;
            display: block;
            text-align: center;
        }
        .hero-content .subheading {
            margin-top: 0.1rem;
            margin-bottom: 1.2rem;
            font-size: 1.5rem;
        }
        .kol-details-modal-content {
            max-width: 420px;
            width: 95vw;
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            text-align: center;
        }
        .kol-details-img-frame {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px;
            border-radius: 20px;
            background: linear-gradient(135deg, #ffb6e6 0%, #a259ff 100%);
            margin-bottom: 1.2rem;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .kol-details-img {
            width: 180px;
            height: 240px;
            object-fit: cover;
            border-radius: 16px;
            background: #fff;
            box-shadow: 0 2px 12px rgba(0,0,0,0.10);
            display: block;
        }
        .kol-details-modal h2 {
            margin: 0 0 0.7rem 0;
            font-size: 2rem;
            font-weight: 700;
        }
        .kol-details-modal p {
            margin: 0.3rem 0;
            font-size: 1.1rem;
        }
        .kol-details-modal .kol-appointment-btn {
            margin-top: 1.5rem;
            width: 100%;
            font-size: 1.2rem;
            padding: 0.8rem 0;
        }
        .kol-controls {
            display: flex;
            align-items: center;
            background: #f8fafd;
            border-radius: 24px;
            box-shadow: 0 4px 24px rgba(162,89,255,0.07);
            padding: 22px 32px 22px 22px;
            margin-bottom: 36px;
            gap: 22px;
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        .kol-search {
            border-radius: 999px;
            border: 1.5px solid #e0e0e0;
            padding: 14px 28px;
            font-size: 1.1rem;
            background: #fff;
            transition: border 0.2s, box-shadow 0.2s;
            min-width: 220px;
            max-width: 320px;
            outline: none;
        }
        .kol-search:focus {
            border-color: #a259ff;
            box-shadow: 0 0 0 2px #e6d6ff;
        }
        .choices,
        .kol-dropdown {
            flex: 1 1 0;
            min-width: 0;
            max-width: 100%;
        }
        .choices__inner {
            width: 100%;
            min-height: 48px;
            border-radius: 16px;
            padding: 12px 18px;
            font-size: 1.08rem;
            border: 1.5px solid #e0e0e0;
            background: #fff;
            transition: border 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
            color: #222;
        }
        .choices__inner.is-focused {
            border-color: #a259ff;
            box-shadow: 0 0 0 2px #e6d6ff;
        }
        .choices__placeholder {
            color: #b0b0b0 !important;
            font-weight: 500;
            font-size: 1.08rem;
            letter-spacing: 0.01em;
        }
        .choices__list--dropdown, .choices__list[aria-expanded] {
            width: 100% !important;
            min-width: 0;
            max-width: 100vw;
            box-sizing: border-box;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(162,89,255,0.13);
            border: 1.5px solid #a259ff;
            margin-top: 4px;
            z-index: 2000 !important;
            background: #fff;
        }
        .choices__item--choice {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: normal;
            max-width: 100%;
            padding: 12px 18px;
            border-radius: 10px;
            margin-bottom: 2px;
            transition: background 0.15s, color 0.15s;
            font-size: 1.08rem;
        }
        .choices__item--choice.is-selected,
        .choices__item--choice.is-highlighted {
            background: #f3eaff;
            color: #a259ff;
        }
        .choices__item--choice:hover {
            background: #f0f0f0;
            color: #222;
        }
        .choices__list--multiple .choices__item {
            background: #17607d;
            color: #fff;
            border-radius: 999px;
            padding: 6px 18px;
            font-size: 1.05rem;
            margin: 2px 4px 2px 0;
            border: none;
        }
        .kol-filter-btn {
            background: #fff;
            color: #e74c3c;
            border: 2px solid #e74c3c;
            border-radius: 999px;
            font-size: 1.15rem;
            font-weight: 700;
            padding: 12px 32px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(231,76,60,0.06);
        }
        .kol-filter-btn:hover {
            background: linear-gradient(90deg, #ffb6e6 0%, #a259ff 100%);
            color: #fff;
            border-color: #a259ff;
        }
        @media (max-width: 900px) {
            .kol-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                padding: 14px 8px;
                max-width: 100vw;
            }
            .kol-search {
                min-width: 0;
                max-width: 100vw;
                width: 100%;
            }
            .kol-dropdown,
            .choices {
                min-width: 0;
                max-width: 100vw;
                width: 100%;
            }
            .choices__list--dropdown, .choices__list[aria-expanded] {
                width: 100vw !important;
                max-width: 100vw;
            }
        }
        #kol-grid {
            margin-top: 32px;
        }
        .choices[data-type*="select-multiple"].has-items .choices__placeholder {
            display: none !important;
        }
        .choices.has-items .choices__placeholder,
        .choices__inner .choices__placeholder {
            display: none !important;
        }
    </style>
</head>
<body>
    <header class="hero">
        <img src="/static/KOLective%20Logo.png" alt="KOLective Logo" class="kole-logo">
        <video class="hero-video" autoplay muted loop playsinline>
            <source src="{{ url_for('static', filename='HeaderVideo.mp4') }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div class="container hero-content">
            <img src="/static/KOLective.png" alt="KOLective" class="kole-hero-img">
            <p class="subheading">AI-powered matching platform to help brands find the right influencer effortlessly.</p>
            <a href="#get-started" class="cta-button">Get Started</a>
        </div>
    </header>

    <!-- Our Partners Section -->
    <section class="partners-section">
        <div class="container">
            <h2 style="text-align:center; font-family:'Poppins','Inter',Arial,sans-serif; font-size:2.5rem; font-weight:800; margin-bottom:2rem;">Our Partners</h2>
            <div style="display:flex; justify-content:center;">
                <iframe src="https://widgets.commoninja.com/iframe/d48784b6-32db-4c8a-964d-c7c570fdd08f" style="width:100%;max-width:900px;min-height:200px;border:none;overflow:hidden;" loading="lazy" title="Our Partners"></iframe>
            </div>
        </div>
    </section>

    <section class="how-it-works">
        <div class="container how-it-works-content">
            <h2>How It Works</h2>
            <div class="steps">
                <div class="step">
                    <h3>1. Input Your Needs</h3>
                    <p>Select your industry, audience, and campaign goals.</p>
                </div>
                <div class="step">
                    <h3>2. AI Matching</h3>
                    <p>Our AI scans real influencer profiles and ranks them for fit.</p>
                </div>
                <div class="step">
                    <h3>3. Connect & Collaborate</h3>
                    <p>View detailed profiles and contact KOLs directly.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="testimonials">
        <div class="container testimonials-content">
            <h2>What Our Users Say</h2>
            <div class="testimonial-slider-arrows-wrapper" style="display: flex; align-items: center; justify-content: center; gap: 1.5rem;">
                <img src="/static/arrow.png" id="testimonial-arrow-right" alt="Next" style="width:36px; height:36px; transform: scaleX(-1); cursor:pointer; user-select:none;">
                <div class="testimonial-slider-multi" id="testimonial-slider-multi">
                    <!-- Cards will be rendered here by JS -->
                </div>
                <img src="/static/arrow.png" id="testimonial-arrow-left" alt="Previous" style="width:36px; height:36px; cursor:pointer; user-select:none;">
            </div>
        </div>
    </section>

    <section id="kol-section" class="kol-section">
        <div class="container">
            <h1 style="margin-bottom: 1.5rem;">KOLective: Meet Your Perfect KOL Match</h1>
            <div class="kol-controls">
                <input type="text" id="kol-search" class="kol-search" placeholder="Search or filter">
                <select id="kol-platform" class="kol-dropdown" multiple></select>
                <select id="kol-category" class="kol-dropdown" multiple></select>
                <select id="kol-location" class="kol-dropdown" multiple></select>
                <button class="kol-filter-btn">Filters</button>
            </div>
            <div id="kol-grid" class="kol-grid">
                <!-- KOL cards will be rendered here by JS -->
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 KOLective. All rights reserved.</p>
        </div>
    </footer>

    <!-- Modal structure for appointment -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Submit Collaboration Request</h2>
            <div class="form-container">
                <div id="loading-form" style="display: none; text-align: center; padding: 2rem;">
                    <p>Loading form...</p>
                </div>
                <iframe id="google-form-iframe"
                        width="100%" 
                        height="600" 
                        frameborder="0" 
                        marginheight="0" 
                        marginwidth="0"
                        style="border: none; max-width: 100%;">
                    Loadingâ€¦
                </iframe>
            </div>
        </div>
    </div>

    <!-- KOL Details Modal -->
    <div id="kolDetailsModal" class="modal">
        <div class="modal-content kol-details-modal-content">
            <span class="close" id="closeKolDetails">&times;</span>
            <div id="kolDetailsBody"></div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Back to Top">
      <svg viewBox="0 0 32 32" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <path d="M16 26V6"/>
        <path d="M8 14l8-8 8 8"/>
      </svg>
    </button>

    <script>
    // Smooth scroll for Get Started button
    document.querySelector('.cta-button').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('kol-section').scrollIntoView({ behavior: 'smooth' });
    });

    // Bar chart categories and icons
    const barCategories = [
      { key: 'Overall', icon: 'â­', color: '#27ae60' },
      { key: 'Follower Count', icon: 'ï¿½ï¿½', color: '#3498db' },
      { key: 'Cost', icon: 'ðŸ’µ', color: '#f1c40f' }
    ];

    const MAX_FOLLOWERS = 500000;
    function parseFollowers(str) {
      if (!str) return 0;
      str = str.toString().replace(/,/g, '').trim();
      if (str.endsWith('M')) return parseFloat(str) * 1000000;
      if (str.endsWith('k') || str.endsWith('K')) return parseFloat(str) * 1000;
      return parseFloat(str) || 0;
    }

    // Fetch KOL data from backend
    fetch('/api/kols')
      .then(response => response.json())
      .then(kols => {
        // Add bar data
        kols.forEach(kol => {
          if (!kol.barData) {
            kol.barData = {
              Overall: Math.random() * 0.4 + 0.6, // 0.6-1.0
              'Follower Count': Math.min(parseFollowers(kol.Followers) / MAX_FOLLOWERS, 1),
              Cost: Math.random() * 0.4 + 0.6 // 0.6-1.0
            };
          }
        });
        // Populate dropdowns
        populateDropdown('kol-platform', kols.map(k => k.Platform));
        populateDropdown('kol-category', getUniqueCategories(kols));
        populateDropdown('kol-location', getUniqueLocations(kols));
        // Initialize Choices.js after options are populated
        new Choices('#kol-platform', { removeItemButton: true, searchEnabled: true, placeholder: true, placeholderValue: 'Select platform(s)' });
        new Choices('#kol-category', { removeItemButton: true, searchEnabled: true, placeholder: true, placeholderValue: 'Select category(s)' });
        new Choices('#kol-location', { removeItemButton: true, searchEnabled: true, placeholder: true, placeholderValue: 'Select location(s)' });

        function getFilters() {
          function getSelectedValues(select) {
            return Array.from(select.selectedOptions).map(opt => opt.value);
          }
          return {
            search: document.getElementById('kol-search').value.toLowerCase(),
            platform: getSelectedValues(document.getElementById('kol-platform')),
            category: getSelectedValues(document.getElementById('kol-category')),
            location: getSelectedValues(document.getElementById('kol-location'))
          };
        }

        function filterKOLs() {
          const { search, platform, category, location } = getFilters();
          renderKOLs(kols.filter(kol => {
            const matchesSearch =
              kol['KOL Nickname'].toLowerCase().includes(search) ||
              kol['Platform'].toLowerCase().includes(search) ||
              normalizeLocation(kol['Location']).toLowerCase().includes(search) ||
              kol['Category'].toLowerCase().includes(search) ||
              (kol['Bio'] || '').toLowerCase().includes(search);

            // If 'All' is selected or nothing is selected, treat as no filter
            const matchesPlatform = platform.length === 0 || platform.includes('All') || platform.includes(kol['Platform']);
            const matchesCategory = category.length === 0 || category.includes('All') ||
              kol['Category'].toLowerCase().split(',').map(c => c.trim()).some(cat => category.map(c => c.toLowerCase()).includes(cat));
            const matchesLocation = location.length === 0 || location.includes('All') || location.includes(normalizeLocation(kol['Location']));

            return matchesSearch && matchesPlatform && matchesCategory && matchesLocation;
          }));
        }

        document.getElementById('kol-search').addEventListener('input', filterKOLs);
        document.getElementById('kol-platform').addEventListener('change', filterKOLs);
        document.getElementById('kol-category').addEventListener('change', filterKOLs);
        document.getElementById('kol-location').addEventListener('change', filterKOLs);

        filterKOLs();
      });

    // Synonym mapping for categories
    const CATEGORY_SYNONYMS = {
      'make up': 'Makeup',
      'makeup': 'Makeup',
      'beauty & make up': 'Beauty & Makeup',
      'beauty & makeup': 'Beauty & Makeup',
      // Add more as needed
    };
    function normalizeCategory(cat) {
      if (!cat) return '';
      const norm = cat.trim().toLowerCase();
      return CATEGORY_SYNONYMS[norm] || cat.trim();
    }
    // Synonym mapping for platforms
    const PLATFORM_SYNONYMS = {
      'fb': 'Facebook',
      'facebook': 'Facebook',
      'ig': 'Instagram',
      'ins': 'Instagram',
      'insta': 'Instagram',
      'instagram': 'Instagram',
      'tik tok': 'Tiktok',
      'tiktok': 'Tiktok',
      'red': 'RED',
      // Add more as needed
    };
    function normalizePlatform(pf) {
      if (!pf) return '';
      const norm = pf.trim().toLowerCase();
      return PLATFORM_SYNONYMS[norm] || pf.trim();
    }
    // Synonym mapping for locations
    const LOCATION_SYNONYMS = {
      'kl': 'Kuala Lumpur',
      'kuala lumpur': 'Kuala Lumpur',
      'jb': 'Johor Bahru',
      'johor bahru': 'Johor Bahru',
      // Add more as needed
    };
    function normalizeLocationFilter(loc) {
      if (!loc) return '';
      const norm = loc.trim().toLowerCase();
      return LOCATION_SYNONYMS[norm] || loc.trim();
    }
    function populateDropdown(id, values) {
      const select = document.getElementById(id);
      const seen = new Set();
      values.forEach(val => {
        if (val) {
          let displayVal = val.trim();
          let norm;
          if (id === 'kol-category') {
            displayVal = normalizeCategory(val);
            norm = displayVal.toLowerCase();
          } else if (id === 'kol-platform') {
            displayVal = normalizePlatform(val);
            norm = displayVal.toLowerCase();
          } else if (id === 'kol-location') {
            displayVal = normalizeLocationFilter(val);
            norm = displayVal.toLowerCase();
          } else {
            norm = val.trim().toLowerCase();
          }
          if (!seen.has(norm)) {
            seen.add(norm);
            const option = document.createElement('option');
            option.value = displayVal;
            option.textContent = displayVal;
            select.appendChild(option);
          }
        }
      });
    }

    function formatFollowers(f) {
        if (f >= 1000000) return (f / 1000000).toFixed(1) + 'M';
        if (f >= 1000) return (f / 1000).toFixed(0) + 'k';
        return f;
    }

    function renderKOLs(kols) {
        const container = document.getElementById('kol-grid');
        container.innerHTML = '';
        const MAX_FOLLOWERS = 500000;
        // Sort KOLs by followers descending and get top 3
        const sortedKOLs = [...kols].sort((a, b) => {
            const fa = typeof a.Followers === 'number' ? a.Followers : parseInt(a.Followers.toString().replace(/,/g, ''));
            const fb = typeof b.Followers === 'number' ? b.Followers : parseInt(b.Followers.toString().replace(/,/g, ''));
            return fb - fa;
        });
        const top3Names = sortedKOLs.slice(0, 3).map(kol => kol['KOL Nickname']);
        kols.forEach(kol => {
            const card = document.createElement('div');
            card.className = 'kol-card';
            // Use the image path as-is, ensuring proper URL encoding
            let photoUrl = kol.Photo;
            if (photoUrl) {
                // Extract the filename from the URL
                const filename = photoUrl.split('/').pop();
                // Encode only the filename
                const encodedFilename = encodeURIComponent(filename);
                const finalUrl = `/static/KOL_Picture/${encodedFilename}`;
                card.style.backgroundImage = `url('${finalUrl}')`;
            }
            // Calculate normalized values
            const followers = typeof kol.Followers === 'number' ? kol.Followers : parseInt(kol.Followers.toString().replace(/,/g, ''));
            // Engagement rate: handle '2.5%' or '0.025' or 'N/A'
            let engagement = 0;
            if (kol['Engagement Rate']) {
                if (typeof kol['Engagement Rate'] === 'string' && kol['Engagement Rate'].includes('%')) {
                    engagement = parseFloat(kol['Engagement Rate']) / 100;
                } else {
                    engagement = parseFloat(kol['Engagement Rate']);
                    if (engagement > 1) engagement = engagement / 100;
                }
            }
            const followerBar = Math.min(followers / MAX_FOLLOWERS, 1);
            const MAX_ENGAGEMENT = 0.10;
            const engagementBar = Math.min(engagement / MAX_ENGAGEMENT, 1);
            let overallBar = followerBar + engagementBar;
            if (overallBar > 1) overallBar = 1;
            card.innerHTML = `
                ${top3Names.includes(kol['KOL Nickname']) ? '<img src="/static/love.png" class="kol-star-icon" alt="Top Follower" />' : ''}
                <div class="kol-info">
                    <h2>${kol['KOL Nickname']}</h2>
                    <p class="location">${kol.Location || ''}</p>
                    <p class="bio">${kol.Bio || ''}</p>
                </div>
                <div class="kol-card-overlay">
                    <div class="kol-bar-row">
                        <span class="kol-bar-label">Overall</span>
                        <div class="kol-bar-bg">
                            <div class="kol-bar-fill" data-width="${Math.round(overallBar*100)}" style="background:#27ae60"></div>
                        </div>
                    </div>
                    <div class="kol-bar-row">
                        <span class="kol-bar-label">Follower Count</span>
                        <div class="kol-bar-bg">
                            <div class="kol-bar-fill" data-width="${Math.round(followerBar*100)}" style="background:#3498db"></div>
                        </div>
                    </div>
                    <div class="kol-bar-row">
                        <span class="kol-bar-label">Engagement Rate</span>
                        <div class="kol-bar-bg">
                            <div class="kol-bar-fill" data-width="${Math.round(engagementBar*100)}" style="background:#f1c40f"></div>
                        </div>
                    </div>
                    <button class="kol-appointment-btn">Send An Appointment</button>
                </div>
            `;
            // Animate bars on overlay hover
            card.addEventListener('mouseenter', function() {
                this.querySelectorAll('.kol-bar-fill').forEach(bar => {
                    setTimeout(() => {
                        bar.style.width = bar.getAttribute('data-width') + '%';
                    }, 100);
                });
            });
            card.addEventListener('mouseleave', function() {
                this.querySelectorAll('.kol-bar-fill').forEach(bar => {
                    bar.style.width = '0%';
                });
            });
            // Add click event to open modal with details
            card.addEventListener('click', function(e) {
                // Prevent overlay button from triggering twice
                if (e.target.classList.contains('kol-appointment-btn')) return;
                showKOLDetailsModal(kol);
            });
            // Add overlay button event
            card.querySelector('.kol-appointment-btn').addEventListener('click', function(e) {
                e.stopPropagation();
                openAppointmentForm(kol);
            });
            container.appendChild(card);
        });
    }

    function getUniqueCategories(kols) {
        const catSet = new Set();
        kols.forEach(kol => {
            if (kol.Category) {
                kol.Category.split(',').forEach(cat => {
                    const clean = cat.trim();
                    if (clean) catSet.add(clean.charAt(0).toUpperCase() + clean.slice(1).toLowerCase());
                });

            }
        });
        return Array.from(catSet).sort();
    }

    function normalizeLocation(loc) {
        if (!loc) return '';
        let l = loc.trim().toLowerCase();
        if (l === 'kl' || l === 'kuala lumpur') return 'Kuala Lumpur';
        if (l === 'jb' || l === 'johor bahru') return 'Johor Bahru';
        if (l.includes('melaka')) return 'Melaka';
        // Add more normalization rules as needed
        return l.charAt(0).toUpperCase() + l.slice(1);
    }

    function getUniqueLocations(kols) {
        const locSet = new Set();
        kols.forEach(kol => {
            if (kol.Location) {
                const norm = normalizeLocation(kol.Location);
                if (norm) locSet.add(norm);
            }
        });
        return Array.from(locSet).sort();
    }

    const PLATFORM_CORRECTIONS = {
      'insagram': 'Instagram',
      'instagram': 'Instagram',
      'tiktok': 'Tiktok',
      'tik tok': 'Tiktok',
      'red': 'RED',
      'facebook': 'Facebook'
    };
    function getUniquePlatforms(kols) {
      const platMap = new Map();
      kols.forEach(kol => {
        if (kol.Platform) {
          let plat = kol.Platform.trim().toLowerCase();
          plat = PLATFORM_CORRECTIONS[plat] || plat.charAt(0).toUpperCase() + plat.slice(1);
          if (plat && !platMap.has(plat)) platMap.set(plat, plat);
        }
      });
      return Array.from(platMap.values()).sort();
    }

    // --- Testimonial Slider Multi-Card ---
    const names = [
        "Sarah Tan", "Jason Lee", "Emily Wong", "Alicia Lim", "Ben Chua", "Rachel Ng", "David Ong", "Siti Aminah", "Kevin Lau", "Joanne Teo",
        "Marcus Tan", "Vivian Goh", "Aaron Lim", "Nadia Zulkifli", "Farah Hassan", "Syafiq Rahman", "Chloe Chan", "Daniel Yap", "Michelle Lee", "Hafiz Ismail"
    ];
    const companies = [
        "Marketing Manager at FoodieMart", "Social Media Lead at Trendify", "Brand Strategist at GlowUp", "PR Specialist at UrbanEats", "Campaign Manager at StyleHive",
        "Agency Director at InfluencePro", "E-commerce Owner at Shopwise", "Startup Founder at Snaply", "Digital Marketer at AdVance", "Content Lead at BuzzReach",
        "Head of Partnerships at Collabify", "Influencer Manager at Brandly", "Outreach Lead at Connectly", "Growth Marketer at ViralEdge", "Community Manager at EngageHub"
    ];
    const testimonialMessages = [
        "KOLective helped us find the perfect influencer for our campaign!",
        "Our brand awareness skyrocketed after using KOLective.",
        "The platform is intuitive and easy to use.",
        "We connected with amazing KOLs in just a few clicks.",
        "KOLective's AI matching is a game changer!",
        "We saved so much time on influencer outreach.",
        "The results exceeded our expectations.",
        "Highly recommended for any business looking to grow.",
        "The filtering options made it easy to find the right fit.",
        "Our engagement rates improved dramatically.",
        "KOLective's support team is fantastic!",
        "We discovered micro-influencers we never knew about.",
        "The campaign tracking tools are super helpful.",
        "We saw a big boost in sales after our KOL campaign.",
        "The onboarding process was smooth and simple.",
        "We love the detailed KOL profiles.",
        "KOLective made influencer marketing accessible for our small business.",
        "The recommendations were spot on.",
        "We found KOLs who truly matched our brand values.",
        "The platform is fast and reliable.",
        "We appreciate the transparency in KOL data.",
        "KOLective is now our go-to for influencer campaigns.",
        "The search and filter features are top-notch.",
        "We got more leads than ever before.",
        "The KOL appointment system is so convenient.",
        "We love the modern design and user experience.",
        "KOLective helped us reach a younger audience.",
        "The analytics dashboard is very insightful.",
        "We were able to launch our campaign in record time.",
        "The KOL vetting process gave us peace of mind.",
        "We found niche influencers for our unique product.",
        "The platform keeps getting better with new features.",
        "KOLective is a must-have for digital marketers.",
        "We appreciate the fair pricing structure.",
        "The influencer recommendations were highly relevant.",
        "We love the ability to book appointments directly.",
        "KOLective made collaboration seamless.",
        "The platform is packed with useful features.",
        "We saw a huge increase in social media mentions.",
        "The KOL profiles are very detailed and helpful.",
        "We were able to track ROI easily.",
        "KOLective is perfect for both big and small brands.",
        "The customer support is responsive and knowledgeable.",
        "We found influencers in our local area easily.",
        "The platform is always up to date with trends.",
        "We love the campaign management tools.",
        "KOLective helped us build long-term influencer relationships.",
        "The platform is very user-friendly.",
        "We appreciate the quick onboarding process.",
        "KOLective made it easy to compare KOLs side by side.",
        "We got great value for our investment.",
        "The influencer discovery process is effortless.",
        "We love the real-time analytics.",
        "KOLective is the best influencer platform we've used.",
        "The platform helped us expand into new markets.",
        "We found KOLs who genuinely love our products.",
        "The appointment system saves us so much time.",
        "KOLective's recommendations are always relevant.",
        "We appreciate the detailed engagement metrics.",
        "The platform is perfect for agencies and brands alike.",
        "We love the easy communication tools.",
        "KOLective helped us increase our brand loyalty.",
        "The platform is very customizable.",
        "We found influencers for every budget.",
        "KOLective's AI is incredibly accurate.",
        "The platform is secure and trustworthy.",
        "We love the seamless integration with our workflow.",
        "KOLective made influencer marketing stress-free.",
        "The platform is always improving.",
        "We appreciate the honest KOL reviews.",
        "KOLective helped us reach our campaign goals.",
        "The influencer search is lightning fast.",
        "We love the variety of KOLs available.",
        "KOLective is a game changer for our business.",
        "The platform is intuitive and efficient.",
        "We found the perfect match for our campaign.",
        "KOLective's data-driven approach is impressive.",
        "The platform is easy to navigate.",
        "We love the personalized recommendations.",
        "KOLective helped us boost our online presence.",
        "The platform is reliable and consistent.",
        "We appreciate the clear reporting tools.",
        "KOLective made it easy to manage multiple campaigns.",
        "The influencer outreach tools are fantastic.",
        "We love the flexibility of the platform.",
        "KOLective is our secret weapon for influencer marketing.",
        "The platform is packed with value.",
        "We found KOLs who align with our mission.",
        "KOLective helped us grow our audience.",
        "The platform is perfect for startups.",
        "We appreciate the fast response times.",
        "KOLective made influencer marketing accessible.",
        "The platform is very intuitive.",
        "We love the easy-to-use dashboard.",
        "KOLective helped us achieve our marketing goals.",
        "The platform is a must-have for any marketer.",
        "We found influencers in every niche.",
        "KOLective's support team is always helpful.",
        "The platform is robust and scalable.",
        "We love the innovative features.",
        "KOLective made it easy to track campaign success.",
        "The platform is a joy to use.",
        "We appreciate the regular updates.",
        "KOLective helped us maximize our ROI.",
        "The platform is the best investment we've made.",
        "We love the community of KOLs.",
        "KOLective is the future of influencer marketing."
    ];
    const testimonials = [];
    for (let i = 0; i < testimonialMessages.length; i++) {
        const name = names[Math.floor(Math.random() * names.length)];
        const company = companies[Math.floor(Math.random() * companies.length)];
        testimonials.push({
            text: testimonialMessages[i],
            cite: `â€“ ${name}, ${company}`
        });
    }
    let testimonialIndex = 0;
    function renderTestimonialCards() {
        const container = document.getElementById('testimonial-slider-multi');
        container.innerHTML = '';
        // Show 3 at a time (responsive: 1 on mobile)
        let cardsToShow = 3;
        if (window.innerWidth < 900) cardsToShow = 1;
        for (let i = 0; i < cardsToShow; i++) {
            const idx = (testimonialIndex + i) % testimonials.length;
            const t = testimonials[idx];
            const card = document.createElement('div');
            card.className = 'testimonial-card';
            card.innerHTML = `<blockquote>"${t.text}"</blockquote><cite>${t.cite}</cite>`;
            container.appendChild(card);
        }
    }
    function nextTestimonialCards() {
        testimonialIndex = (testimonialIndex + 1) % testimonials.length;
        renderTestimonialCards();
    }
    function prevTestimonialCards() {
        testimonialIndex = (testimonialIndex - 1 + testimonials.length) % testimonials.length;
        renderTestimonialCards();
    }
    setInterval(nextTestimonialCards, 3500);
    window.addEventListener('resize', renderTestimonialCards);
    renderTestimonialCards();
    // Arrow click handlers
    document.getElementById('testimonial-arrow-left').onclick = prevTestimonialCards;
    document.getElementById('testimonial-arrow-right').onclick = nextTestimonialCards;
    // --- End Testimonial Slider Multi-Card ---

    // Back to Top Button logic
    const backToTopBtn = document.getElementById('backToTopBtn');
    window.onscroll = function() {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            backToTopBtn.style.display = 'flex';
        } else {
            backToTopBtn.style.display = 'none';
        }
    };
    backToTopBtn.onclick = function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // Modal logic
    const modal = document.getElementById("appointmentModal");
    const closeBtn = document.querySelector(".close");

    // Open modal for any appointment button
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('kol-appointment-btn')) {
            modal.style.display = "block";
        }
    });

    closeBtn.onclick = () => {
        modal.style.display = "none";
    };

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    };

    // Helper to fade modals
    function fadeModalOut(modal, callback) {
        modal.style.opacity = '0';
        setTimeout(() => {
            modal.style.display = 'none';
            modal.classList.remove('show');
            if (callback) callback();
        }, 300);
    }
    function fadeModalIn(modal) {
        modal.style.display = 'block';
        modal.style.opacity = '0';
        setTimeout(() => {
            modal.classList.add('show');
            modal.style.opacity = '1';
        }, 10);
    }

    // Show KOL Details Modal
    function showKOLDetailsModal(kol) {
        const modal = document.getElementById('kolDetailsModal');
        const body = document.getElementById('kolDetailsBody');
        // Format engagement rate as percentage
        let engagementRate = kol['Engagement Rate'];
        if (typeof engagementRate === 'string') engagementRate = parseFloat(engagementRate);
        if (!isNaN(engagementRate)) {
            if (engagementRate <= 1) engagementRate = (engagementRate * 100).toFixed(1) + '%';
            else engagementRate = engagementRate.toFixed(1) + '%';
        } else {
            engagementRate = kol['Engagement Rate'];
        }
        // Build details HTML
        let details = `<div class=\"kol-details-modal\">\n            <div class=\"kol-details-img-frame\">\n                <img src=\"${kol.Photo}\" alt=\"${kol['KOL Nickname']}\" class=\"kol-details-img\" />\n            </div>\n            <h2>${kol['KOL Nickname']}</h2>\n            <p><strong>Followers:</strong> ${kol.Followers}</p>\n            <p><strong>Engagement Rate:</strong> ${engagementRate}</p>\n            <p><strong>Platform:</strong> ${kol.Platform || ''}</p>\n            <p><strong>Category:</strong> ${kol.Category || ''}</p>\n            <p><strong>Location:</strong> ${kol.Location || ''}</p>\n            <p><strong>Bio:</strong> ${kol.Bio || ''}</p>\n            <button class=\"kol-appointment-btn\">Send An Appointment</button>\n        </div>`;
        body.innerHTML = details;
        // Add appointment button event
        body.querySelector('.kol-appointment-btn').onclick = function(e) {
            e.stopPropagation();
            openAppointmentForm(kol);
        };
        fadeModalIn(modal);
    }
    // Close KOL Details Modal
    document.getElementById('closeKolDetails').onclick = function() {
        fadeModalOut(document.getElementById('kolDetailsModal'));
    };
    window.onclick = function(event) {
        if (event.target == document.getElementById('kolDetailsModal')) {
            fadeModalOut(document.getElementById('kolDetailsModal'));
        }
        if (event.target == document.getElementById('appointmentModal')) {
            fadeModalOut(document.getElementById('appointmentModal'));
        }
    };

    // Function to open appointment form with pre-filled KOL data
    function openAppointmentForm(kol) {
        const loadingDiv = document.getElementById('loading-form');
        const formIframe = document.getElementById('google-form-iframe');
        
        // Show loading state
        loadingDiv.style.display = 'block';
        formIframe.style.display = 'none';

        // Google Form base URL
        const baseFormUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSesuQpVwOMh6DlhTqjzJ4uADDAijtD4Jshjxjq1LFag-8sPgQ/viewform';

        // Prefill the KOL name
        const params = new URLSearchParams({
            'entry.1705840221': kol['KOL Nickname']
        });

        // Final URL for the iframe
        const formUrl = `${baseFormUrl}?${params.toString()}&embedded=true`;

        // Set the iframe source
        formIframe.src = formUrl;

        // Hide loading when form loads
        formIframe.onload = function() {
            loadingDiv.style.display = 'none';
            formIframe.style.display = 'block';
        };

        // Close KOL details modal and open appointment modal
        fadeModalOut(document.getElementById('kolDetailsModal'), function() {
            fadeModalIn(document.getElementById('appointmentModal'));
        });
    }
    </script>
    <!-- Choices.js JS -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</body>
</html> 
